<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Your Order | OshanCart Global</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --oshan-orange: #ff6600; 
            --gray-light: #f1f1f1;
            --text-dark: #333;
        }
        body { 
            font-family: 'Poppins', sans-serif; 
            background: #f4f4f7; 
            margin: 0; 
            padding: 20px; 
            color: var(--text-dark);
        }
        .container { 
            max-width: 500px; 
            margin: 40px auto; 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
        }
        
        /* Header Logic */
        .order-summary { 
            border-bottom: 2px solid var(--gray-light); 
            padding-bottom: 15px; 
            margin-bottom: 25px; 
            text-align: center;
        }
        .order-summary h2 { margin: 0; font-size: 22px; font-weight: 600; }
        .order-id-label { 
            color: var(--oshan-orange); 
            font-weight: 600; 
            background: #fff0e6;
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 8px;
            font-size: 14px;
        }

        /* Vertical Stepper Design */
        .stepper { 
            display: flex; 
            flex-direction: column; 
            gap: 0; 
            position: relative; 
            margin-left: 10px;
        }
        
        /* අයිකන අතර සම්බන්ධ වන ඉර */
        .step { 
            display: flex; 
            align-items: flex-start; 
            gap: 20px; 
            position: relative; 
            padding-bottom: 40px; 
            opacity: 0.3; 
            transition: all 0.5s ease;
        }
        .step:last-child { padding-bottom: 0; }
        
        /* ඉර නිර්මාණය */
        .step::before {
            content: "";
            position: absolute;
            left: 17px;
            top: 35px;
            bottom: 0;
            width: 3px;
            background: var(--gray-light);
            z-index: 1;
        }
        .step:last-child::before { display: none; }
        
        /* Active status එකේදී ඉරේ පාට මාරු කිරීම */
        .step.active { opacity: 1; }
        .step.active::before { background: var(--oshan-orange); }

        .step-icon { 
            width: 38px; 
            height: 38px; 
            background: #ddd; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 16px; 
            z-index: 2;
            transition: 0.3s;
        }
        .step.active .step-icon { 
            background: var(--oshan-orange); 
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.4); 
        }

        .step-info h4 { margin: 0; font-size: 16px; font-weight: 600; }
        .step-info p { margin: 4px 0 0; font-size: 13px; color: #777; line-height: 1.4; }

        .back-btn { 
            text-decoration: none; 
            color: #888; 
            font-size: 14px; 
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            transition: 0.3s;
        }
        .back-btn:hover { color: var(--oshan-orange); }

        /* Animation */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .step.active:not(.completed) .step-icon {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>

<div class="container">
    <a href="orders.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Orders</a>
    
    <div class="order-summary">
        <h2>Order Status</h2>
        <div id="orderIdDisplay" class="order-id-label">Loading ID...</div>
    </div>

    <div class="stepper" id="trackingStepper">
        <div class="step" id="step-pending">
            <div class="step-icon"><i class="fas fa-shopping-basket"></i></div>
            <div class="step-info">
                <h4>Order Placed</h4>
                <p>We've successfully received your order.</p>
            </div>
        </div>

        <div class="step" id="step-processing">
            <div class="step-icon"><i class="fas fa-box-open"></i></div>
            <div class="step-info">
                <h4>In Warehouse</h4>
                <p>Your item is being packed and quality checked.</p>
            </div>
        </div>

        <div class="step" id="step-shipped">
            <div class="step-icon"><i class="fas fa-shipping-fast"></i></div>
            <div class="step-info">
                <h4>Out for Delivery</h4>
                <p>The package has left our center and is on its way.</p>
            </div>
        </div>

        <div class="step" id="step-delivered">
            <div class="step-icon"><i class="fas fa-check-double"></i></div>
            <div class="step-info">
                <h4>Delivered</h4>
                <p>Package handed over to the customer.</p>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    // --- 1. සම්පූර්ණ කරන ලද Firebase Config ---
    const firebaseConfig = {
        apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
        authDomain: "oshancart.firebaseapp.com",
        projectId: "oshancart",
        storageBucket: "oshancart.appspot.com",
        messagingSenderId: "686982543488",
        appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
    };

    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();

   // 1. URL එකේ අග තියෙන දත්ත කියවීම
const urlParams = new URLSearchParams(window.location.search);
const orderId = urlParams.get('id'); // අර අපි එවපු 'id' එක මෙතනදී අල්ලගන්නවා

// 2. ඒ ID එක පේජ් එකේ පෙන්වීම
const displayElement = document.getElementById('orderIdDisplay');
if(orderId) {
    displayElement.innerText = "Order: #" + orderId.substring(0, 12).toUpperCase();
} else {
    displayElement.innerText = "Order ID Not Found";
}

    // සජීවීව දත්ත ලබා ගැනීම (Live Tracking)
    function trackLive() {
        if(!orderId) return;

        db.collection("orders").doc(orderId).onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                const status = data.status ? data.status.toLowerCase() : 'pending';
                updateStepper(status);
            } else {
                console.error("No such order found!");
            }
        });
    }

    function updateStepper(status) {
        // සියලුම පියවරවල් reset කිරීම
        const steps = document.querySelectorAll('.step');
        steps.forEach(s => s.classList.remove('active', 'completed'));

        // Status එක අනුව අදාළ පියවරවල් සක්‍රීය කිරීම
        document.getElementById('step-pending').classList.add('active', 'completed');
        
        if (["processing", "shipped", "delivered"].includes(status)) {
            document.getElementById('step-processing').classList.add('active', 'completed');
        }
        
        if (["shipped", "delivered"].includes(status)) {
            document.getElementById('step-shipped').classList.add('active', 'completed');
        }
        
        if (status === "delivered") {
            document.getElementById('step-delivered').classList.add('active', 'completed');
        }
    }

    window.onload = trackLive;
</script>
</body>
</html>
