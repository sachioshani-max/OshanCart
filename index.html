<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OshanCart | Smart Global Shopping</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.2/css/flag-icons.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #c9184a;
            --secondary: #ffccd5;
            --amazon-blue: #131921;
            --amazon-light: #232f3e;
            --accent: #febd69;
            --white: #ffffff;
            --gray: #f3f3f3;
            --text: #333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--gray); overflow-x: hidden; }

        /* ==========================================
           DESKTOP NAVIGATION (Original + Enhanced)
           ========================================== */
        nav {
            background: var(--amazon-blue);
            padding: 10px 4%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            height: 70px;
        }

        .nav-left { display: flex; align-items: center; gap: 20px; }
        
        /* Mobile Menu Icon (Hidden on Desktop) */
        .mobile-menu-trigger {
            display: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        .logo { font-size: 26px; font-weight: 800; color: white; text-decoration: none; }
        .logo span { color: var(--accent); }

        /* Search Bar Engine */
        .search-container {
            flex: 1;
            display: flex;
            max-width: 800px;
            margin: 0 20px;
            background: white;
            border-radius: 6px;
            overflow: hidden;
        }

        .cat-dropdown { position: relative; border-right: 1px solid #ccc; }
        .cat-btn {
            background: #eee;
            padding: 12px 15px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            min-width: 130px;
        }

        .cat-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            width: 250px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1100;
        }

        .cat-menu a {
            padding: 12px 20px;
            display: block;
            text-decoration: none;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }

        .cat-menu a:hover { background: var(--gray); color: var(--primary); }
        .cat-dropdown:hover .cat-menu { display: block; }

        .search-container input {
            flex: 1;
            border: none;
            padding: 10px 15px;
            outline: none;
            font-size: 15px;
        }

        .search-btn {
            background: var(--accent);
            border: none;
            padding: 0 20px;
            cursor: pointer;
            font-size: 18px;
        }

        /* Nav Right Items */
        .nav-right { display: flex; align-items: center; gap: 25px; color: white; }

        .lang-select { position: relative; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .lang-dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            min-width: 160px;
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 10px 0;
        }

        .lang-dropdown-content a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            color: #333;
            text-decoration: none;
            font-size: 13px;
        }

        .lang-select:hover .lang-dropdown-content { display: block; }

        /* User Menu Mega Style */
        .user-acc { position: relative; cursor: pointer; }
        .user-acc span { font-size: 12px; color: #ccc; }
        .user-acc b { display: block; font-size: 14px; }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: -50px;
            background: white;
            width: 260px;
            border-radius: 4px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 15px;
            color: #333;
        }

        .user-dropdown a {
            display: block;
            padding: 10px 0;
            text-decoration: none;
            color: #333;
            font-size: 13px;
            border-bottom: 1px solid #eee;
        }

        .user-dropdown .admin-btn { background: #333; color: white; text-align: center; border-radius: 4px; margin-top: 10px; }
        .user-acc:hover .user-dropdown { display: block; }

        .cart-box { position: relative; text-decoration: none; color: white; display: flex; align-items: center; gap: 8px; }
        .cart-badge {
            position: absolute; top: -8px; left: 15px;
            background: var(--accent); color: black;
            font-size: 11px; font-weight: bold;
            padding: 2px 6px; border-radius: 50%;
        }

        /* ==========================================
           MOBILE VERSION OPTIMIZATION (Aliexpress/Shein)
           ========================================== */
        @media (max-width: 768px) {
            nav { padding: 10px; height: auto; flex-wrap: wrap; }
            .mobile-menu-trigger { display: block; }
            .search-container { order: 3; width: 100%; margin: 10px 0 0 0; }
            .nav-right { display: none; } /* Hide desktop icons */
            .cat-dropdown { display: none; } /* Use mobile drawer instead */
            
            /* Bottom App Bar */
            .bottom-app-bar {
                position: fixed; bottom: 0; left: 0; width: 100%;
                background: white; display: flex; justify-content: space-around;
                padding: 10px 0; border-top: 1px solid #ddd; z-index: 2000;
            }
            .app-item { text-align: center; text-decoration: none; color: #666; font-size: 10px; }
            .app-item i { display: block; font-size: 20px; margin-bottom: 3px; }
            .app-item.active { color: var(--primary); }

            /* Grid Adjustments */
            .product-grid { grid-template-columns: 1fr 1fr !important; padding: 10px !important; gap: 10px !important; }
            .product-card { padding: 8px !important; border-radius: 12px !important; }
        }

        /* ==========================================
           SIDE DRAWER (MOBILE MENU)
           ========================================== */
        .drawer {
            position: fixed; top: 0; left: -100%; width: 80%; height: 100%;
            background: white; z-index: 3000; transition: 0.4s;
            overflow-y: auto;
        }
        .drawer.open { left: 0; }
        .drawer-header { background: var(--amazon-blue); color: white; padding: 20px; font-size: 18px; }
        .drawer-links a { display: block; padding: 15px 20px; text-decoration: none; color: #333; border-bottom: 1px solid #eee; font-size: 15px; }
        
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2500; display: none;
        }

        /* ==========================================
           COMPONENTS (AI, ADMIN, PRODUCTS)
           ========================================== */
        .ai-agent-fab {
            position: fixed; bottom: 80px; right: 20px;
            width: 60px; height: 60px; background: var(--primary);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 30px; cursor: pointer;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 1500;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        .container { padding: 20px 4%; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .product-card { background: white; border-radius: 8px; padding: 15px; transition: 0.3s; position: relative; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .product-img { width: 100%; height: 200px; object-fit: contain; }
        .product-name { font-size: 14px; font-weight: 500; margin: 10px 0; height: 40px; overflow: hidden; }
        .product-price { font-size: 20px; font-weight: 700; color: #B12704; }
        .buy-now { background: var(--accent); border: none; width: 100%; padding: 10px; border-radius: 20px; margin-top: 10px; font-weight: bold; cursor: pointer; }

        /* AI CHAT BOX */
        #aiWindow {
            display: none; position: fixed; bottom: 100px; right: 20px;
            width: 350px; height: 450px; background: white; border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 2001; flex-direction: column;
        }
        .ai-header { background: var(--primary); color: white; padding: 15px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; }
        #aiMessages { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; font-size: 13px; }
        .ai-input { display: flex; padding: 10px; border-top: 1px solid #eee; }
        .ai-input input { flex: 1; border: none; outline: none; padding: 8px; }
    </style>
</head>
<body>

    <div class="overlay" id="overlay" onclick="toggleDrawer()"></div>

    <div class="drawer" id="drawer">
        <div class="drawer-header">
            <i class="fas fa-user-circle"></i> Hello, Sign In
        </div>
        <div class="drawer-links">
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
            <a href="profile.html"><i class="fas fa-user-edit"></i> Profile Settings</a>
            <a href="orders.html"><i class="fas fa-box"></i> My Orders</a>
            <a href="referral.html"><i class="fas fa-users"></i> Referral Program</a>
            <hr>
            <b style="padding: 15px 20px; display: block;">Categories</b>
            <a href="#" onclick="filterCat('Womens')">üëó Womens Fashion</a>
            <a href="#" onclick="filterCat('Mens')">üëï Mens Fashion</a>
            <a href="#" onclick="filterCat('Electronics')">üì± Electronics</a>
            <a href="#" onclick="filterCat('Home')">üè† Home & Kitchen</a>
            <a href="#" onclick="filterCat('Ceylon Items')">üá±üá∞ Ceylon Items</a>
            <hr>
            <a href="#" onclick="accessAdmin()"><i class="fas fa-lock"></i> Admin Dashboard</a>
        </div>
    </div>

    <nav>
        <div class="nav-left">
            <i class="fas fa-bars mobile-menu-trigger" onclick="toggleDrawer()"></i>
            <a href="index.html" class="logo">Oshan<span>Cart</span></a>
        </div>

        <div class="search-container">
            <div class="cat-dropdown">
                <button class="cat-btn">All <i class="fas fa-caret-down"></i></button>
                <div class="cat-menu">
                    <a href="#" onclick="filterCat('All')">All Categories</a>
                    <a href="#" onclick="filterCat('Womens')">Womens Fashion</a>
                    <a href="#" onclick="filterCat('Mens')">Mens Fashion</a>
                    <a href="#" onclick="filterCat('Home')">Home & Kitchen</a>
                    <a href="#" onclick="filterCat('Phones')">Smartphones</a>
                    <a href="#" onclick="filterCat('Ceylon')">Ceylon Unique Items</a>
                    <a href="#" onclick="filterCat('Vehicles')">Vehicles & Parts</a>
                </div>
            </div>
            <input type="text" id="mainSearch" placeholder="Search for products, brands and more...">
            <button class="search-btn" onclick="runSearch()"><i class="fas fa-search"></i></button>
        </div>

        <div class="nav-right">
            <div class="lang-select" id="google_translate_element_trigger">
                <span class="fi fi-us"></span> EN <i class="fas fa-caret-down"></i>
                <div class="lang-dropdown-content">
                    <a href="#" onclick="changeLang('en')"><span class="fi fi-us"></span> English</a>
                    <a href="#" onclick="changeLang('si')"><span class="fi fi-lk"></span> Sinhala</a>
                    <a href="#" onclick="changeLang('hi')"><span class="fi fi-in"></span> Hindi</a>
                </div>
            </div>

            <div class="user-acc">
                <span>Hello, Sign in</span>
                <b>Account & Lists <i class="fas fa-caret-down"></i></b>
                <div class="user-dropdown">
                    <a href="profile.html"><b>My Profile</b></a>
                    <a href="orders.html">My Orders</a>
                    <a href="wishlist.html">My Wishlist</a>
                    <a href="referral.html">Referral Earnings</a>
                    <a href="affiliate.html">Affiliate Program</a>
                    <hr>
                    <a href="seller-signup.html">Become a Seller</a>
                    <a href="seller-dashboard.html">Seller Dashboard</a>
                    <a href="#" onclick="accessAdmin()" class="admin-btn">Admin Panel</a>
                </div>
            </div>

            <a href="cart.html" class="cart-box">
                <i class="fas fa-shopping-cart" style="font-size: 24px;"></i>
                <span class="cart-badge" id="cartCount">0</span>
                <b>Cart</b>
            </a>
        </div>
    </nav>

    <div class="container">
        <h2 id="viewTitle" style="margin-bottom: 20px;">Trending Products</h2>
        <div class="product-grid" id="productGrid">
            <p>Fetching amazing deals for you...</p>
        </div>
    </div>

    <div class="ai-agent-fab" onclick="toggleAI()">
        <i class="fas fa-robot"></i>
    </div>

    <div id="aiWindow">
        <div class="ai-header">
            <span><i class="fas fa-robot"></i> Oshan AI Assistant</span>
            <i class="fas fa-times" onclick="toggleAI()" style="cursor:pointer"></i>
        </div>
        <div id="aiMessages">
            <p><b>Oshan AI:</b> Hello! I am your smart shopping assistant. How can I help you today?</p>
        </div>
        <div class="ai-input">
            <input type="text" id="aiQuery" placeholder="Ask anything...">
            <button onclick="askAI()" style="border:none; background:var(--primary); color:white; padding:5px 10px; border-radius:4px;"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="bottom-app-bar">
        <a href="index.html" class="app-item active"><i class="fas fa-home"></i>Home</a>
        <a href="#" class="app-item" onclick="toggleDrawer()"><i class="fas fa-th-large"></i>Category</a>
        <a href="cart.html" class="app-item"><i class="fas fa-shopping-cart"></i>Cart</a>
        <a href="profile.html" class="app-item"><i class="fas fa-user"></i>Account</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
            authDomain: "oshancart.firebaseapp.com",
            projectId: "oshancart",
            storageBucket: "oshancart.appspot.com",
            messagingSenderId: "686982543488",
            appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let allProducts = [];

        // 1. Fetch & Display
        async function loadProducts() {
            const snap = await getDocs(collection(db, "products"));
            allProducts = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderProducts(allProducts);
        }

        function renderProducts(data) {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = data.map(p => `
                <div class="product-card">
                    <img src="${p.itemImage || p.image}" class="product-img" onclick="location.href='product.html?id=${p.id}'">
                    <p class="product-name">${p.itemName || p.name}</p>
                    <p class="product-price">Rs. ${parseFloat(p.itemPrice || p.price).toLocaleString()}</p>
                    <button class="buy-now" onclick="location.href='checkout.html?id=${p.id}'">Buy Now</button>
                </div>
            `).join('');
        }

        // 2. Search & Filter
        window.runSearch = () => {
            const q = document.getElementById('mainSearch').value.toLowerCase();
            renderProducts(allProducts.filter(p => (p.itemName || p.name).toLowerCase().includes(q)));
        };

        window.filterCat = (cat) => {
            toggleDrawer();
            document.getElementById('viewTitle').innerText = cat + " Selection";
            if(cat === 'All') renderProducts(allProducts);
            else renderProducts(allProducts.filter(p => p.category === cat));
        };

        // 3. UI Helpers
        window.toggleDrawer = () => {
            const d = document.getElementById('drawer');
            const o = document.getElementById('overlay');
            d.classList.toggle('open');
            o.style.display = d.classList.contains('open') ? 'block' : 'none';
        };

        window.toggleAI = () => {
            const win = document.getElementById('aiWindow');
            win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
        };

        window.askAI = () => {
            const input = document.getElementById('aiQuery');
            const msgBox = document.getElementById('aiMessages');
            if(!input.value) return;
            msgBox.innerHTML += `<p style="text-align:right; color:blue;"><b>You:</b> ${input.value}</p>`;
            
            // Simulating Real AI logic
            setTimeout(() => {
                msgBox.innerHTML += `<p><b>Oshan AI:</b> I found 3 products related to "${input.value}". Would you like to see them?</p>`;
                msgBox.scrollTop = msgBox.scrollHeight;
            }, 1000);
            input.value = "";
        };

        // 4. Admin Security (As requested)
        window.accessAdmin = () => {
            let pass = prompt("Access Restricted. Enter Admin Key:");
            if(pass === "Lakshan@2001") window.location.href = "admin-dashboard.html";
            else alert("Invalid Access!");
        };

        loadProducts();
    </script>

    <div id="google_translate_element" style="display:none"></div>
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
        }
        function changeLang(langCode) {
            const select = document.querySelector('.goog-te-combo');
            if (select) {
                select.value = langCode;
                select.dispatchEvent(new Event('change'));
            }
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</body>
</html>
