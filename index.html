<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oshan Cart | Premium Global Shopping</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.2/css/flag-icons.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #c9184a;
            --amazon-blue: #131921;
            --amazon-light: #232f3e;
            --accent: #febd69;
            --bg-gray: #f3f3f3;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-gray); overflow-x: hidden; }

        /* ==========================================
           DESKTOP NAVIGATION (ORIGINAL RESTORED)
           ========================================== */
        header { display: block; }
        nav {
            background: var(--amazon-blue);
            padding: 10px 3%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            color: white;
        }

        .logo { font-size: 24px; font-weight: 700; color: white; text-decoration: none; display: flex; align-items: center; }
        .logo span { color: var(--accent); }

        .search-container { flex: 1; display: flex; align-items: center; max-width: 800px; margin: 0 20px; }
        
        .cat-dropdown { position: relative; }
        .cat-btn {
            background: #f3f3f3; color: #555; padding: 12px 15px; font-size: 13px; border: none;
            border-radius: 4px 0 0 4px; cursor: pointer; display: flex; align-items: center; gap: 5px; min-width: 130px;
        }
        .cat-content {
            display: none; position: absolute; background: white; min-width: 250px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); top: 100%; border-radius: 0 0 8px 8px; z-index: 2000;
        }
        .cat-content a { color: #333; padding: 12px 20px; text-decoration: none; display: flex; align-items: center; justify-content: space-between; font-size: 14px; border-bottom: 1px solid #f0f0f0; transition: 0.3s; }
        .cat-content a:hover { background: #fff0f3; color: var(--primary); padding-left: 25px; }
        .cat-dropdown:hover .cat-content { display: block; }

        .search-bar { flex: 1; display: flex; position: relative; }
        .search-bar input { width: 100%; border: none; padding: 12px 15px; outline: none; font-size: 14px; }
        .search-submit { background: var(--accent); border: none; padding: 0 20px; border-radius: 0 4px 4px 0; cursor: pointer; color: #333; font-size: 18px; }

        .nav-right { display: flex; align-items: center; gap: 25px; }

        /* Flag / Language Selector */
        .lang-dropdown { position: relative; cursor: pointer; display: flex; align-items: center; gap: 5px; font-size: 14px; padding: 10px 5px; }
        .lang-menu { 
            display: none; position: absolute; background: white; top: 100%; right: 0; min-width: 160px; 
            border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); padding: 10px 0; 
        }
        .lang-menu a { color: #333; padding: 10px 20px; text-decoration: none; display: flex; align-items: center; gap: 10px; font-size: 13px; }
        .lang-menu a:hover { background: #f8f8f8; }
        .lang-dropdown:hover .lang-menu { display: block; }

        /* User Account Menu (Original Links Restored) */
        .user-menu { position: relative; cursor: pointer; padding: 5px 0; }
        .user-menu span { display: block; font-size: 12px; color: #ccc; }
        .user-menu b { font-size: 14px; display: flex; align-items: center; gap: 4px; }
        .user-content {
            display: none; position: absolute; background: white; top: 100%; right: 0; min-width: 260px;
            border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); padding: 15px 0; z-index: 2000;
        }
        .user-content .btn-signin { background: linear-gradient(to bottom, #f8e3ad, #eeb82a); border: 1px solid #a88734; border-radius: 4px; margin: 10px 20px; padding: 8px; text-align: center; color: black; font-weight: bold; text-decoration: none; display: block; }
        .user-content a { color: #333; padding: 10px 20px; text-decoration: none; display: block; font-size: 13px; }
        .user-content a:hover { background: #f3f3f3; color: var(--primary); text-decoration: underline; }
        .user-content hr { border: 0; border-top: 1px solid #eee; margin: 10px 0; }
        .user-menu:hover .user-content { display: block; }

        .cart-icon { position: relative; cursor: pointer; text-decoration: none; color: white; display: flex; align-items: center; gap: 8px; }
        .cart-count { background: var(--accent); color: black; font-size: 12px; min-width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: absolute; top: -8px; left: 15px; font-weight: bold; border: 2px solid var(--amazon-blue); }

        /* ==========================================
           MOBILE VERSION (APP-LIKE OPTIMIZATION)
           ========================================== */
        .mobile-only { display: none; }

        @media (max-width: 768px) {
            header, nav { display: none; } /* Hide Desktop Nav */
            .mobile-only { display: block; }

            /* Mobile Top Header (AliExpress Style) */
            .mobile-header {
                background: var(--amazon-blue); padding: 10px 15px; position: sticky; top: 0; z-index: 1500;
                display: flex; flex-direction: column; gap: 10px;
            }
            .m-header-top { display: flex; justify-content: space-between; align-items: center; }
            .m-logo { font-size: 20px; font-weight: bold; color: white; text-decoration: none; }
            .m-logo span { color: var(--accent); }
            
            .m-search-wrapper {
                background: white; border-radius: 25px; display: flex; align-items: center; padding: 8px 15px;
            }
            .m-search-wrapper input { flex: 1; border: none; outline: none; font-size: 14px; margin-left: 10px; }

            /* Drawer Menu Trigger */
            .menu-trigger { font-size: 22px; color: white; cursor: pointer; }

            /* Mobile Bottom Navigation (Shein/Daraz Style) */
            .bottom-nav {
                position: fixed; bottom: 0; left: 0; width: 100%; background: white;
                display: flex; justify-content: space-around; align-items: center;
                padding: 10px 0; border-top: 1px solid #ddd; z-index: 2000;
            }
            .nav-item { text-align: center; color: #666; text-decoration: none; font-size: 11px; flex: 1; transition: 0.3s; }
            .nav-item i { font-size: 22px; margin-bottom: 4px; display: block; }
            .nav-item.active { color: var(--primary); }

            /* Sidebar Drawer */
            .sidebar {
                position: fixed; top: 0; left: -100%; width: 80%; height: 100%; background: white;
                z-index: 3000; transition: 0.4s ease; overflow-y: auto; padding: 20px;
            }
            .sidebar.active { left: 0; }
            .overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); z-index: 2900; }
            .overlay.active { display: block; }
            
            .sidebar h3 { font-size: 18px; margin-bottom: 20px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
            .sidebar a { display: flex; align-items: center; gap: 15px; padding: 12px 0; color: #333; text-decoration: none; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        }

        /* AI Customer Agent Floating Button */
        .ai-agent {
            position: fixed; bottom: 85px; right: 20px; width: 60px; height: 60px;
            background: var(--primary); border-radius: 50%; display: flex;
            align-items: center; justify-content: center; color: white;
            font-size: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer; z-index: 1001; animation: bounce 2s infinite;
        }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* Account Settings Section (Mobile View) */
        .account-settings-page { display: none; background: white; padding: 20px; min-height: 100vh; }
        .account-settings-page.active { display: block; }

        /* Grid System (Responsive) */
        .container { padding: 20px 3%; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        
        @media (max-width: 768px) {
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .container { padding: 10px; }
        }

        .product-card {
            background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: 0.3s; padding: 10px; position: relative;
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .product-img { width: 100%; height: 200px; object-fit: contain; }
        .product-name { font-size: 14px; height: 40px; overflow: hidden; color: #333; margin: 10px 0; font-weight: 500; }
        .product-price { font-size: 18px; color: #B12704; font-weight: 700; }
        .buy-btn { background: var(--accent); border: none; padding: 10px; border-radius: 6px; width: 100%; font-weight: bold; margin-top: 10px; cursor: pointer; }

    </style>
</head>
<body>

    <header>
        <nav>
            <a href="index.html" class="logo">Oshan<span>Cart</span></a>
            
            <div class="search-container">
                <div class="cat-dropdown">
                    <button class="cat-btn">All <i class="fas fa-caret-down"></i></button>
                    <div class="cat-content" id="desktopCat">
                        </div>
                </div>
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Search Oshan Cart for items, brands and more...">
                    <button class="search-submit" onclick="search()"><i class="fas fa-search"></i></button>
                </div>
            </div>

            <div class="nav-right">
                <div class="lang-dropdown">
                    <span id="currentFlag" class="fi fi-us"></span> <span id="currentLang">EN</span> <i class="fas fa-caret-down"></i>
                    <div class="lang-menu">
                        <a href="#" onclick="changeLang('en', 'fi-us')"><span class="fi fi-us"></span> English (US)</a>
                        <a href="#" onclick="changeLang('si', 'fi-lk')"><span class="fi fi-lk"></span> Sinhala (SL)</a>
                        <a href="#" onclick="changeLang('hi', 'fi-in')"><span class="fi fi-in"></span> Hindi (IN)</a>
                        <a href="#" onclick="changeLang('ae', 'fi-ae')"><span class="fi fi-ae"></span> Arabic (UAE)</a>
                    </div>
                </div>

                <div class="user-menu">
                    <span>Hello, Sign in</span>
                    <b>Account & Lists <i class="fas fa-caret-down"></i></b>
                    <div class="user-content">
                        <a href="login.html" class="btn-signin">Sign in</a>
                        <p style="text-align:center; font-size:11px;">New customer? <a href="signup.html" style="display:inline; padding:0; color:blue;">Start here.</a></p>
                        <hr>
                        <a href="profile.html">‚úçÔ∏è Me (My Profile)</a>
                        <a href="orders.html">üéÅ My Orders</a>
                        <a href="referral.html">ü§ù My Referral</a>
                        <a href="affiliate.html">üë• Affiliate Program</a>
                        <a href="seller-signup.html">üë©üèª‚Äçüåæ Become a Seller</a>
                        <a href="seller-dashboard.html">üìä Seller Dashboard</a>
                        <hr>
                        <a href="#" onclick="adminLogin()">üë§ Admin Panel</a>
                        <a href="customer-service.html">ü§ñ Customer Services</a>
                    </div>
                </div>

                <a href="cart.html" class="cart-icon">
                    <i class="fas fa-shopping-cart" style="font-size: 24px;"></i>
                    <span class="cart-count">0</span>
                    <b>Cart</b>
                </a>
            </div>
        </nav>
    </header>

    <div class="mobile-only">
        <div class="mobile-header">
            <div class="m-header-top">
                <i class="fas fa-bars menu-trigger" onclick="toggleSidebar()"></i>
                <a href="index.html" class="m-logo">Oshan<span>Cart</span></a>
                <div style="display: flex; gap: 15px; color: white; font-size: 20px;">
                    <i class="fas fa-camera" onclick="alert('Image Search Coming Soon!')"></i>
                    <a href="cart.html" style="color:white; position:relative;">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </a>
                </div>
            </div>
            <div class="m-search-wrapper">
                <i class="fas fa-search" style="color: #999;"></i>
                <input type="text" placeholder="I'm shopping for..." id="mobileSearch">
            </div>
        </div>

        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
        <div class="sidebar" id="sidebar">
            <h3>Shop By Category</h3>
            <div id="mobileCatList">
                </div>
            <hr>
            <h3>Account Settings</h3>
            <a href="profile.html"><i class="fas fa-user-cog"></i> Account Info</a>
            <a href="address.html"><i class="fas fa-map-marker-alt"></i> Shipping Address</a>
            <a href="language.html"><i class="fas fa-globe"></i> Language / Currency</a>
            <a href="help.html"><i class="fas fa-headset"></i> Help Center</a>
        </div>

        <div class="bottom-nav">
            <a href="index.html" class="nav-item active"><i class="fas fa-home"></i>Home</a>
            <a href="javascript:void(0)" class="nav-item" onclick="toggleSidebar()"><i class="fas fa-th-large"></i>Category</a>
            <a href="cart.html" class="nav-item"><i class="fas fa-shopping-cart"></i>Cart</a>
            <a href="javascript:void(0)" class="nav-item" onclick="openMobileAccount()"><i class="fas fa-user"></i>Account</a>
        </div>
    </div>

    <div class="ai-agent" onclick="alert('Oshan AI: How can I help you today?')">
        <i class="fas fa-robot"></i>
    </div>

    <div class="container">
        <div class="product-grid" id="productDisplay">
            </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Restore Original Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
            authDomain: "oshancart.firebaseapp.com",
            projectId: "oshancart",
            storageBucket: "oshancart.appspot.com",
            messagingSenderId: "686982543488",
            appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const categories = [
            { name: "Womens Fashion", icon: "üëó" },
            { name: "Mens Fashion", icon: "üëï" },
            { name: "Home & Kitchen", icon: "üè†" },
            { name: "Electronics", icon: "üì±" },
            { name: "Jewelry", icon: "üíç" },
            { name: "Dried Food", icon: "üç≤" },
            { name: "Cakes", icon: "üéÇ" },
            { name: "Ceylon Items", icon: "üá±üá∞" },
            { name: "Vehicles", icon: "üöó" }
        ];

        let allProducts = [];

        // --- Load UI Data ---
        function initUI() {
            // Desktop Categories
            const dCat = document.getElementById('desktopCat');
            dCat.innerHTML = `<a href="#" onclick="filterCat('All')">All Categories</a>` + 
                categories.map(c => `<a href="#" onclick="filterCat('${c.name}')">${c.name} ${c.icon}</a>`).join('');

            // Mobile Categories
            const mCat = document.getElementById('mobileCatList');
            mCat.innerHTML = categories.map(c => `
                <a href="#" onclick="filterCat('${c.name}'); toggleSidebar();">
                    <span>${c.icon} ${c.name}</span>
                    <i class="fas fa-chevron-right" style="font-size:12px; color:#999;"></i>
                </a>
            `).join('');
        }

        // --- Firebase Product Fetch ---
        async function fetchProducts() {
            try {
                const snapshot = await getDocs(collection(db, "products"));
                allProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderProducts(allProducts);
            } catch (err) { console.error("Firebase Fetch Error:", err); }
        }

        function renderProducts(items) {
            const grid = document.getElementById('productDisplay');
            grid.innerHTML = items.map(item => `
                <div class="product-card">
                    <div onclick="location.href='product-details.html?id=${item.id}'" style="cursor:pointer">
                        <img src="${item.image || item.itemImage}" class="product-img">
                        <p class="product-name">${item.name || item.itemName}</p>
                        <p class="product-price">Rs. ${parseFloat(item.price || 0).toLocaleString()}</p>
                        <p style="font-size: 11px; color: green; margin-top:5px;"><i class="fas fa-shipping-fast"></i> Free Global Shipping</p>
                    </div>
                    <button class="buy-btn" onclick="location.href='checkout.html?id=${item.id}'">Buy Now</button>
                </div>
            `).join('');
        }

        // --- Global Functions (Restored & Fixed) ---
        window.toggleSidebar = () => {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        };

        window.filterCat = (cat) => {
            if (cat === 'All') renderProducts(allProducts);
            else renderProducts(allProducts.filter(p => p.category === cat));
        };

        window.changeLang = (lang, flagClass) => {
            document.getElementById('currentFlag').className = `fi ${flagClass}`;
            document.getElementById('currentLang').innerText = lang.toUpperCase();
            alert(`Language switched to ${lang.toUpperCase()}`);
        };

        window.adminLogin = () => {
            const pw = prompt("Enter Admin Secure Password:");
            if (pw === "Lakshan@2001") window.location.href = "admin-dashboard.html";
            else alert("Access Denied!");
        };

        window.openMobileAccount = () => {
            // Alibaba-style mobile account summary
            alert("Account Center: \n- Orders\n- Settings\n- Wallet\n- Support");
        };

        // Initialize Everything
        initUI();
        fetchProducts();

        // Search logic
        const sInput = document.getElementById('searchInput');
        const mInput = document.getElementById('mobileSearch');
        const searchHandler = (e) => {
            const query = e.target.value.toLowerCase();
            renderProducts(allProducts.filter(p => (p.name || p.itemName || "").toLowerCase().includes(query)));
        };
        sInput.addEventListener('input', searchHandler);
        mInput.addEventListener('input', searchHandler);

    </script>
</body>
</html>
