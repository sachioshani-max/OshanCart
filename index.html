<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oshan Cart | Global Smart Shopping</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.2/css/flag-icons.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #c9184a;
            --amazon-blue: #131921;
            --amazon-light: #232f3e;
            --accent: #febd69;
            --bg-gray: #f3f3f3;
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-gray); overflow-x: hidden; }

        /* ==========================================
           DESKTOP NAVIGATION (Original Extended)
        ========================================== */
        .desktop-nav {
            background: var(--amazon-blue);
            padding: 10px 4%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
            color: white;
        }

        .logo { font-size: 24px; font-weight: 700; color: white; text-decoration: none; }
        .logo span { color: var(--accent); }

        .search-wrapper {
            flex: 1;
            display: flex;
            max-width: 800px;
            margin: 0 20px;
        }

        .cat-select {
            background: #f3f3f3;
            border-radius: 4px 0 0 4px;
            border: none;
            padding: 0 10px;
            cursor: pointer;
            font-size: 13px;
            border-right: 1px solid #ddd;
        }

        .search-wrapper input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            outline: none;
            font-size: 14px;
        }

        .search-btn {
            background: var(--accent);
            border: none;
            padding: 10px 20px;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            transition: 0.3s;
        }

        .nav-tools { display: flex; align-items: center; gap: 25px; }

        /* Language Dropdown Logic */
        .lang-box { position: relative; cursor: pointer; display: flex; align-items: center; gap: 6px; }
        .lang-dropdown {
            display: none; position: absolute; top: 100%; left: 0;
            background: white; color: black; min-width: 150px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); border-radius: 4px; padding: 10px 0; z-index: 1001;
        }
        .lang-dropdown a {
            display: flex; align-items: center; gap: 10px; padding: 8px 15px;
            text-decoration: none; color: #333; font-size: 13px;
        }
        .lang-dropdown a:hover { background: #f0f0f0; }
        .lang-box:hover .lang-dropdown { display: block; }

        /* User Account Dropdown - FULL RESTORED */
        .account-box { position: relative; cursor: pointer; }
        .account-dropdown {
            display: none; position: absolute; top: 100%; right: 0;
            background: white; color: black; min-width: 240px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2); border-radius: 8px; padding: 15px 0; z-index: 1001;
        }
        .account-dropdown h4 { padding: 0 20px 10px; font-size: 14px; border-bottom: 1px solid #eee; }
        .account-dropdown a {
            display: block; padding: 10px 20px; color: #333; text-decoration: none; font-size: 13px;
        }
        .account-dropdown a:hover { background: #f5f5f5; color: var(--primary); }
        .account-box:hover .account-dropdown { display: block; }

        /* ==========================================
           MOBILE VERSION (AliExpress/Shein Style)
        ========================================== */
        .mobile-header {
            display: none;
            background: var(--amazon-blue);
            padding: 12px 15px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .mobile-top-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        
        /* Mobile Hamburger */
        .menu-trigger { color: white; font-size: 22px; cursor: pointer; }

        .mobile-search-bar {
            background: white;
            border-radius: 25px;
            display: flex;
            align-items: center;
            padding: 5px 15px;
        }
        .mobile-search-bar input { border: none; flex: 1; padding: 8px; outline: none; font-size: 14px; }

        /* Side Drawer Menu */
        .side-menu {
            position: fixed; top: 0; left: -100%; width: 80%; height: 100%;
            background: white; z-index: 2000; transition: 0.4s;
            box-shadow: 10px 0 30px rgba(0,0,0,0.3); overflow-y: auto;
        }
        .side-menu.active { left: 0; }
        .side-header { background: var(--amazon-blue); color: white; padding: 30px 20px; }
        .side-categories a {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; text-decoration: none; color: #333; border-bottom: 1px solid #eee;
        }

        /* Bottom Nav (Full Active) */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: white; display: none; justify-content: space-around;
            padding: 10px 0; box-shadow: 0 -2px 15px rgba(0,0,0,0.1); z-index: 1500;
        }
        .bottom-nav a { text-align: center; color: #666; text-decoration: none; font-size: 11px; flex: 1; position: relative; }
        .bottom-nav a.active { color: var(--primary); }
        .bottom-nav i { display: block; font-size: 20px; margin-bottom: 3px; }

        /* ==========================================
           AI AGENT & CUSTOMER SERVICE
        ========================================== */
        .ai-agent-btn {
            position: fixed; bottom: 80px; right: 20px;
            width: 60px; height: 60px; background: var(--primary);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-size: 28px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* Oshan AI Chat Box */
        .chat-box {
            position: fixed; bottom: 150px; right: 20px; width: 320px; height: 450px;
            background: white; border-radius: 15px; display: none; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 2001; overflow: hidden;
        }
        .chat-header { background: var(--primary); color: white; padding: 15px; display: flex; justify-content: space-between; }
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; background: #f9f9f9; }
        .bot-msg { background: #eee; padding: 8px 12px; border-radius: 10px; margin-bottom: 10px; font-size: 13px; width: fit-content; }
        .chat-input { display: flex; padding: 10px; border-top: 1px solid #eee; }
        .chat-input input { flex: 1; border: none; outline: none; padding: 8px; }

        /* ==========================================
           PRODUCT GRID & CONTENT
        ========================================== */
        .main-container { padding: 20px 4%; }
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white; border-radius: 12px; overflow: hidden;
            transition: 0.3s; position: relative; border: 1px solid #eee;
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .img-container { height: 200px; padding: 15px; background: #fff; }
        .img-container img { width: 100%; height: 100%; object-fit: contain; }
        .info { padding: 15px; }
        .price { font-size: 20px; font-weight: 700; color: #B12704; }
        .buy-now {
            width: 100%; background: var(--accent); border: none; padding: 10px;
            margin-top: 10px; border-radius: 6px; font-weight: 600; cursor: pointer;
        }

        /* ==========================================
           RESPONSIVE OVERRIDES (THE CHALLENGE)
        ========================================== */
        @media (max-width: 768px) {
            .desktop-nav { display: none; }
            .mobile-header { display: block; }
            .bottom-nav { display: flex; }
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
            .img-container { height: 150px; }
            .price { font-size: 16px; }
            body { padding-bottom: 80px; }
            .main-container { padding: 10px; }
        }

        /* Admin Dashboard UI Improvements */
        .admin-panel-overlay {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: white; z-index: 3000; display: none; overflow-y: auto;
        }
    </style>
</head>
<body>

    <div class="side-menu" id="sideMenu">
        <div class="side-header">
            <h3>Hello, Sign In</h3>
            <p>Welcome to OshanCart Global</p>
        </div>
        <div class="side-categories">
            <h4 style="padding: 15px 20px; background: #f0f0f0;">Categories</h4>
            <a href="#" onclick="filterCat('Womens')">Women's Fashion <i class="fa fa-chevron-right"></i></a>
            <a href="#" onclick="filterCat('Mens')">Men's Fashion <i class="fa fa-chevron-right"></i></a>
            <a href="#" onclick="filterCat('Phones')">Phones & Gadgets <i class="fa fa-chevron-right"></i></a>
            <a href="#" onclick="filterCat('Home')">Home & Kitchen <i class="fa fa-chevron-right"></i></a>
            <a href="#" onclick="filterCat('Ceylon')">Ceylon Special üá±üá∞ <i class="fa fa-chevron-right"></i></a>
            <hr>
            <h4 style="padding: 15px 20px; background: #f0f0f0;">Account Settings</h4>
            <a href="profile.html">My Profile <i class="fa fa-user"></i></a>
            <a href="orders.html">My Orders <i class="fa fa-box"></i></a>
            <a href="wallet.html">Withdraw Wallet <i class="fa fa-wallet"></i></a>
            <a href="#" onclick="accessAdmin()">Admin Dashboard <i class="fa fa-lock"></i></a>
        </div>
    </div>

    <nav class="desktop-nav">
        <a href="index.html" class="logo">Oshan<span>Cart</span></a>
        
        <div class="search-wrapper">
            <select class="cat-select">
                <option>All Categories</option>
                <option>Womens Fashion</option>
                <option>Mens Fashion</option>
                <option>Electronics</option>
            </select>
            <input type="text" id="desktopSearch" placeholder="Search for anything global...">
            <button class="search-btn"><i class="fa fa-search"></i></button>
        </div>

        <div class="nav-tools">
            <div class="lang-box" id="currentLang">
                <span class="fi fi-us"></span> EN <i class="fa fa-caret-down"></i>
                <div class="lang-dropdown">
                    <a href="#" onclick="changeLang('us', 'EN')"><span class="fi fi-us"></span> English</a>
                    <a href="#" onclick="changeLang('lk', 'SI')"><span class="fi fi-lk"></span> Sinhala</a>
                    <a href="#" onclick="changeLang('jp', 'JP')"><span class="fi fi-jp"></span> Japanese</a>
                </div>
            </div>

            <div class="account-box">
                <span style="font-size: 12px; display: block; color: #ccc;">Hello, Sign in</span>
                <b>Account & Lists <i class="fa fa-caret-down"></i></b>
                <div class="account-dropdown">
                    <a href="profile.html" style="color: var(--primary); font-weight: 600;">‚úçÔ∏è My Profile</a>
                    <a href="orders.html">üéÅ My Orders</a>
                    <a href="referral.html">ü§ù Referral Program</a>
                    <a href="affiliate.html">üë• Affiliate Center</a>
                    <hr>
                    <a href="seller-dashboard.html">üìä Seller Dashboard</a>
                    <a href="#" onclick="accessAdmin()">üë§ Admin Panel</a>
                </div>
            </div>

            <a href="cart.html" style="color:white; text-decoration:none; display:flex; align-items:center; gap:5px;">
                <div style="position:relative;">
                    <i class="fa fa-shopping-cart" style="font-size: 24px;"></i>
                    <span id="cartCount" style="position:absolute; top:-10px; right:-8px; background:var(--accent); color:black; font-size:11px; padding:2px 6px; border-radius:50%; font-weight:bold;">0</span>
                </div>
                <b>Cart</b>
            </a>
        </div>
    </nav>

    <div class="mobile-header">
        <div class="mobile-top-row">
            <i class="fa fa-bars menu-trigger" onclick="toggleMenu()"></i>
            <a href="index.html" class="logo" style="font-size: 20px;">Oshan<span>Cart</span></a>
            <div style="display: flex; gap: 15px; color: white; font-size: 20px;">
                <i class="fa fa-bell"></i>
                <i class="fa fa-comment-dots" onclick="toggleChat()"></i>
            </div>
        </div>
        <div class="mobile-search-bar">
            <i class="fa fa-search" style="color: #999;"></i>
            <input type="text" id="mobileSearch" placeholder="Search Items..." onkeyup="search()">
            <i class="fa fa-camera" style="color: #999; margin-left: 10px;"></i>
        </div>
    </div>

    <div class="main-container">
        <div class="product-grid" id="productArea">
            </div>
    </div>

    <div class="ai-agent-btn" onclick="toggleChat()">
        <i class="fa fa-robot"></i>
    </div>

    <div class="chat-box" id="chatBox">
        <div class="chat-header">
            <span>Oshan AI - Assistant</span>
            <i class="fa fa-times" onclick="toggleChat()"></i>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="bot-msg">Hello! I am Oshan AI. How can I help your shopping today?</div>
        </div>
        <div class="chat-input">
            <input type="text" id="chatIn" placeholder="Ask Oshan AI...">
            <button onclick="sendMsg()" style="border:none; background:none; color:var(--primary); font-size:20px;"><i class="fa fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="bottom-nav">
        <a href="index.html" class="active"><i class="fa fa-home"></i>Home</a>
        <a href="#" onclick="toggleMenu()"><i class="fa fa-list"></i>Category</a>
        <a href="cart.html"><i class="fa fa-shopping-cart"></i>Cart</a>
        <a href="profile.html"><i class="fa fa-user"></i>Account</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
            authDomain: "oshancart.firebaseapp.com",
            projectId: "oshancart",
            storageBucket: "oshancart.appspot.com",
            messagingSenderId: "686982543488",
            appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let products = [];

        // Fetch Data
        async function load() {
            const querySnapshot = await getDocs(collection(db, "products"));
            products = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            render(products);
        }

        window.render = (items) => {
            const area = document.getElementById('productArea');
            area.innerHTML = items.map(item => `
                <div class="product-card">
                    <div class="img-container" onclick="location.href='product-details.html?id=${item.id}'">
                        <img src="${item.image || item.itemImage}" alt="Product">
                    </div>
                    <div class="info">
                        <p style="font-size:13px; color:#333; height:34px; overflow:hidden;">${item.name || item.itemName}</p>
                        <p class="price">Rs. ${parseFloat(item.price || 0).toLocaleString()}</p>
                        <div style="font-size:11px; color:green; margin-top:5px;"><i class="fa fa-truck"></i> Free Shipping Global</div>
                        <button class="buy-now" onclick="location.href='checkout.html?id=${item.id}'">Buy Now</button>
                    </div>
                </div>
            `).join('');
        };

        // UI Functions
        window.toggleMenu = () => document.getElementById('sideMenu').classList.toggle('active');
        window.toggleChat = () => {
            const box = document.getElementById('chatBox');
            box.style.display = box.style.display === 'flex' ? 'none' : 'flex';
        };

        window.changeLang = (code, text) => {
            document.getElementById('currentLang').innerHTML = `<span class="fi fi-${code}"></span> ${text} <i class="fa fa-caret-down"></i>`;
            alert("Language changed to " + text);
        };

        window.accessAdmin = () => {
            const pass = prompt("Enter Master Admin Password:");
            if(pass === "Lakshan@2001") location.href = "admin-dashboard.html";
            else alert("Unauthorized Access!");
        };

        window.sendMsg = () => {
            const input = document.getElementById('chatIn');
            const msg = input.value;
            if(!msg) return;
            const container = document.getElementById('chatMessages');
            container.innerHTML += `<div style="text-align:right; background:var(--primary); color:white; padding:8px; border-radius:10px; margin-bottom:10px; font-size:13px; margin-left:20px;">${msg}</div>`;
            input.value = "";
            
            setTimeout(() => {
                container.innerHTML += `<div class="bot-msg">Oshan AI is checking "${msg}" in our inventory... One moment.</div>`;
                container.scrollTop = container.scrollHeight;
            }, 1000);
        };

        load();
    </script>
</body>
</html>
