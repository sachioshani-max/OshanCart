<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oshan Cart | Global Hub</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@7.0.2/css/flag-icons.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #f85606; --bg: #f4f4f7; --white: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg); }

        /* --- Desktop Design --- */
        @media (min-width: 992px) {
            .mobile-only { display: none !important; }
            nav { background: var(--white); padding: 15px 5%; display: flex; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
            .logo { font-size: 26px; font-weight: 700; color: var(--primary); text-decoration: none; flex: 0.2; }
            .search-box { flex: 1; margin: 0 30px; display: flex; background: #eff0f5; border-radius: 4px; overflow: hidden; }
            .search-box input { flex: 1; border: none; padding: 12px; background: transparent; outline: none; }
            .search-box button { background: var(--primary); color: white; border: none; padding: 0 20px; cursor: pointer; }
            .hero { display: flex; padding: 20px 5%; gap: 20px; }
            .sidebar { width: 240px; background: white; border-radius: 8px; padding: 10px 0; }
            .sidebar li { list-style: none; padding: 10px 20px; cursor: pointer; transition: 0.2s; font-size: 14px; }
            .sidebar li:hover { background: #fff1eb; color: var(--primary); }
        }

        /* --- Mobile Design --- */
        @media (max-width: 991px) {
            .desktop-only { display: none !important; }
            .mobile-header { background: linear-gradient(135deg, #ff4747, #f85606); padding: 15px; position: sticky; top: 0; z-index: 1000; }
            .mobile-search { background: white; border-radius: 25px; display: flex; align-items: center; padding: 8px 15px; margin-top: 10px; }
            .mobile-search input { border: none; flex: 1; padding: 0 10px; outline: none; }
            .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 2000; }
            .bottom-item { flex: 1; text-align: center; color: #757575; text-decoration: none; font-size: 11px; }
            .bottom-item i { display: block; font-size: 20px; margin-bottom: 2px; }
            .bottom-item.active { color: var(--primary); }
        }

        /* --- Common Styles --- */
        .container { padding: 20px 5%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        @media (max-width: 600px) { .grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } }

        .product-card { background: white; border-radius: 8px; overflow: hidden; transition: 0.3s; cursor: pointer; border: 1px solid #eee; }
        .product-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .product-card img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .p-info { padding: 10px; }
        .p-name { font-size: 13px; height: 38px; overflow: hidden; margin-bottom: 5px; color: #333; }
        .p-price { color: var(--primary); font-size: 16px; font-weight: bold; }
        
        /* Oshan AI Chat */
        .ai-widget { position: fixed; bottom: 80px; right: 20px; z-index: 3000; }
        .ai-btn { width: 60px; height: 60px; background: #0072ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 25px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

    <nav class="desktop-only">
        <a href="index.html" class="logo">OshanCart</a>
        <div class="search-box">
            <input type="text" id="d-search-input" placeholder="Search products...">
            <button onclick="searchProducts('d-search-input')"><i class="fas fa-search"></i></button>
        </div>
        <div style="display:flex; gap:20px;">
            <div onclick="location.href='admin-dashboard.html'" style="cursor:pointer;"><i class="fas fa-user-shield"></i> Admin</div>
            <div onclick="location.href='cart.html'" style="cursor:pointer;"><i class="fas fa-shopping-cart"></i> Cart</div>
        </div>
    </nav>

    <header class="mobile-header mobile-only">
        <div style="display:flex; justify-content:space-between; color:white; align-items:center;">
            <i class="fas fa-bars"></i>
            <h3>OshanCart</h3>
            <i class="fas fa-comment-dots" onclick="toggleChat()"></i>
        </div>
        <div class="mobile-search">
            <i class="fas fa-search"></i>
            <input type="text" id="m-search-input" placeholder="Search anything...">
            <button style="border:none; background:none;" onclick="searchProducts('m-search-input')">GO</button>
        </div>
    </header>

    <main class="hero">
        <aside class="sidebar desktop-only">
            <li onclick="filterCategory('Womens')">Womens Fashion</li>
            <li onclick="filterCategory('Mens')">Mens Fashion</li>
            <li onclick="filterCategory('Phones')">Phones & Gadgets</li>
            <li onclick="filterCategory('Ceylon Items')">Ceylon Special</li>
            <li onclick="filterCategory('All')">All Categories</li>
        </aside>
        <div style="flex:1;">
             <img src="https://ae01.alicdn.com/kf/S8f9038283307409292158866e40854d9I.jpg" style="width:100%; height:300px; object-fit:cover; border-radius:12px;">
        </div>
    </main>

    <section class="container">
        <h2 style="margin-bottom:15px;">Recommended For You</h2>
        <div class="grid" id="productGrid">
            <p style="text-align:center; width:100%;">Loading products...</p>
        </div>
    </section>

    <nav class="bottom-nav mobile-only">
        <a href="index.html" class="bottom-item active"><i class="fas fa-home"></i>Home</a>
        <a href="#" class="bottom-item" onclick="alert('Category menu')"><i class="fas fa-list"></i>Category</a>
        <a href="cart.html" class="bottom-item"><i class="fas fa-shopping-cart"></i>Cart</a>
        <a href="profile.html" class="bottom-item"><i class="fas fa-user"></i>Account</a>
    </nav>

    <div class="ai-widget">
        <div class="ai-btn" onclick="window.open('https://wa.me/94727600501', '_blank')">
            <i class="fab fa-whatsapp"></i>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
            authDomain: "oshancart.firebaseapp.com",
            projectId: "oshancart",
            storageBucket: "oshancart.appspot.com",
            messagingSenderId: "686982543488",
            appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        let allProducts = [];

        async function fetchProducts() {
            try {
                const snapshot = await getDocs(collection(db, "products"));
                allProducts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderGrid(allProducts);
            } catch (error) {
                console.error("Firebase Error:", error);
                document.getElementById('productGrid').innerHTML = "Failed to load products.";
            }
        }

        window.renderGrid = (items) => {
            const grid = document.getElementById('productGrid');
            if (items.length === 0) {
                grid.innerHTML = "<p>No products found.</p>";
                return;
            }
            grid.innerHTML = items.map(p => `
                <div class="product-card" onclick="location.href='product-details.html?id=${p.id}'">
                    <img src="${p.image || 'https://via.placeholder.com/150'}">
                    <div class="p-info">
                        <div class="p-name">${p.name}</div>
                        <div class="p-price">Rs. ${parseFloat(p.price).toLocaleString()}</div>
                        <div style="font-size:11px; color:green; margin-top:5px;"><i class="fas fa-truck"></i> Free Shipping</div>
                    </div>
                </div>
            `).join('');
        };

        window.filterCategory = (cat) => {
            if (cat === 'All') renderGrid(allProducts);
            else renderGrid(allProducts.filter(p => p.category === cat));
        };

        window.searchProducts = (inputId) => {
            const val = document.getElementById(inputId).value.toLowerCase();
            renderGrid(allProducts.filter(p => p.name.toLowerCase().includes(val)));
        };

        fetchProducts();
    </script>
</body>
</html>
