<div class="form-container">
    <h2 style="color: #c9184a;">Add New Product</h2>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        
        <div class="input-group">
            <label>Product Name</label>
            <input type="text" id="p-name" placeholder="eg: Luxury Sofa Set">
        </div>
        <div class="input-group">
            <label>Price (Rs.)</label>
            <input type="number" id="p-price" placeholder="55000">
        </div>

        <div class="input-group">
            <label>Category</label>
            <select id="p-cat">
                <option value="Home & Kitchen">Home & Kitchen üè†</option>
                <option value="Jewelry">Jewelry üíç</option>
                <option value="Phones">Phones üì±</option>
                <option value="Home & Beauty">Home & Beauty üíÑ</option>
                <option value="Money Saving">Money Saving Items üí∞</option>
                <option value="Furniture">Furniture (Sofa/Almari/Mes) üõãÔ∏è</option>
                <option value="Kids">Kids üß∏</option>
                <option value="Men">Men üöπ</option>
                <option value="Women">Women üö∫</option>
            </select>
        </div>

        <div class="input-group">
            <label>Stock Quantity</label>
            <input type="number" id="p-stock" placeholder="eg: 5">
        </div>

        <div class="input-group">
            <label>Delivery Option</label>
            <select id="p-delivery">
                <option value="Free Delivery">Free Delivery</option>
                <option value="Standard Delivery (Rs. 350)">Standard Delivery (Rs. 350)</option>
                <option value="Store Pickup">Store Pickup</option>
            </select>
        </div>

        <div class="input-group">
            <label>Estimated Delivery Time</label>
            <input type="text" id="p-del-time" placeholder="eg: 3-5 Days">
        </div>

        <div class="input-group" style="grid-column: span 2;">
            <label>Product Description (Specs, Sizes, etc.)</label>
            <textarea id="p-desc" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;" placeholder="Describe the item..."></textarea>
        </div>

        <div class="input-group" style="grid-column: span 2;">
            <label>Upload Image</label>
            <div class="upload-box" onclick="document.getElementById('p-file').click()">
                <i class="fas fa-cloud-upload-alt"></i>
                <p id="file-status">Select Product Photo</p>
                <input type="file" id="p-file" accept="image/*" style="display: none;">
            </div>
        </div>
    </div>
    <button class="btn-post" id="add-btn" onclick="addProduct()">List Product Now</button>
</div>

<script type="module">
    // ... Firebase Config eka pahala danna ...

    window.addProduct = async function() {
        const name = document.getElementById('p-name').value;
        const price = document.getElementById('p-price').value;
        const cat = document.getElementById('p-cat').value;
        const stock = document.getElementById('p-stock').value;
        const desc = document.getElementById('p-desc').value;
        const delivery = document.getElementById('p-delivery').value;
        const delTime = document.getElementById('p-del-time').value;
        const btn = document.getElementById('add-btn');

        if(name && price && selectedFile && stock) {
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                // 1. ImgBB Image Upload
                let formData = new FormData();
                formData.append("image", selectedFile);
                const imgRes = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: formData });
                const imgData = await imgRes.json();
                const finalImageUrl = imgData.data.url;

                // 2. Firebase Store (Adding all new fields)
                await addDoc(collection(db, "products"), {
                    name: name,
                    price: parseFloat(price),
                    category: cat,
                    stock: parseInt(stock),
                    description: desc,
                    deliveryInfo: delivery,
                    deliveryTime: delTime,
                    image: finalImageUrl,
                    brand: "Oshan Brand",
                    createdAt: serverTimestamp()
                });

                alert("Product Successfully Added to OshanCart!");
                location.reload();
            } catch (err) {
                alert("Error: " + err.message);
                btn.disabled = false;
                btn.innerText = "List Product Now";
            }
        } else {
            alert("Please fill all required fields!");
        }
    }
</script>
