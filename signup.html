<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signup ğŸ | Oshan Cart ğŸ—½</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
        authDomain: "oshancart.firebaseapp.com",
        projectId: "oshancart",
        storageBucket: "oshancart.firebasestorage.app",
        messagingSenderId: "686982543488",
        appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.handleSignup = async (event) => {
        event.preventDefault();
        
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('email').value;
        const whatsapp = document.getElementById('number').value;
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        // 1. Password à¶´à¶»à·“à¶šà·Šà·‚à· à¶šà·’à¶»à·“à¶¸
        if (password !== confirmPassword) {
            alert("âŒ Passwords do not match!");
            return;
        }

        if (password.length < 6) {
            alert("âŒ Password must be at least 6 characters!");
            return;
        }

        try {
            // 2. Firebase Auth à·„à¶»à·„à· User à¶±à·’à¶»à·Šà¶¸à·à¶«à¶º
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            // 3. à¶…à·„à¶¹à·” Affiliate ID à¶‘à¶šà¶šà·Š à·ƒà·‘à¶¯à·“à¶¸ (à¶‹à¶¯à·: oshan542)
            const randomNum = Math.floor(1000 + Math.random() * 9000);
            const affId = firstName.toLowerCase().replace(/\s/g, '') + randomNum;

            // 4. Firestore à¶‘à¶šà·š à¶¯à¶­à·Šà¶­ à·ƒà·šà·€à·Š à¶šà·’à¶»à·“à¶¸
            await setDoc(doc(db, "users", user.uid), {
                uid: user.uid,
                firstName: firstName,
                lastName: lastName,
                email: email,
                whatsapp: whatsapp,
                affiliateId: affId,
                totalEarnings: 0,
                totalClicks: 0,
                createdAt: new Date()
            });

            alert(`â¤ï¸â€ğŸ©¹ à·ƒà·à¶»à·Šà¶®à¶šà¶ºà·’! à¶”à¶¶à·š Affiliate ID à¶‘à¶š: ${affId}. à¶¯à·à¶±à·Š Login à·€à¶±à·Šà¶±.`);
            
            window.location.href = "login.html";

        } catch (error) {
            console.error(error);
            alert("Error: " + error.message);
        }
    };
</script>
</head>
<body style="background: #fff0f3; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; font-family: 'Segoe UI', sans-serif; padding: 20px 0;">

    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 400px;">
        <h1 style="text-align: center; color: #ff4d6d; margin-bottom: 10px;">Join Oshan Cart ğŸ›ï¸</h1>
        <p style="text-align: center; color: #ff8855; font-size: 13px; margin-bottom: 25px; font-weight: bold;">
            Trusted Digital Marketplace & Income PlatformğŸ¤‘
        </p>

        <form onsubmit="handleSignup(event)">
            <div style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label style="font-size: 13px; color: #555;">First Name</label>
                    <input type="text" id="firstName" placeholder="à¶¸à·”à¶½à·Š à¶±à¶¸" required style="width: 100%; padding: 10px; margin: 5px 0 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline-color: #ff4d6d;">
                </div>
                <div style="flex: 1;">
                    <label style="font-size: 13px; color: #555;">Last Name</label>
                    <input type="text" id="lastName" placeholder="à¶…à¶œ à¶±à¶¸" required style="width: 100%; padding: 10px; margin: 5px 0 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline-color: #ff4d6d;">
                </div>
            </div>
            
            <label style="font-size: 13px; color: #555;">Email Address</label>
            <input type="email" id="email" autocomplete="username" placeholder="example@mail.com" required style="width: 100%; padding: 10px; margin: 5px 0 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline-color: #ff4d6d;">

            <label style="font-size: 13px; color: #555;">WhatsApp Number</label>
            <input type="text" id="number" placeholder="07x xxxxxxx" required style="width: 100%; padding: 10px; margin: 5px 0 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline-color: #ff4d6d;">
            
            <label style="font-size: 13px; color: #555;">Password</label>
            <input type="password" id="password" autocomplete="new-password" placeholder="Min 6 characters (@, #, 123)" required style="width: 100%; padding: 10px; margin: 5px 0 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline-color: #ff4d6d;">

            <label style="font-size: 13px; color: #555;">Confirm Password</label>
            <input type="password" id="confirmPassword" autocomplete="new-password" placeholder="à¶±à·à·€à¶­ à¶‡à¶­à·”à·…à¶­à·Š à¶šà¶»à¶±à·Šà¶±" required style="width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; outline-color: #ff4d6d;">
            
            <button type="submit" style="width: 100%; background: #ff4d6d; color: white; border: none; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 16px;">
                Agree and Register ğŸ“‡
            </button>
        </form>

        <p style="text-align: center; font-size: 13px; margin-top: 15px; color: #666;">
            Already have an account? ğŸ¤— <br>
            <a href="login.html" style="color: #ff4d6d; text-decoration: none; font-weight: bold;">Login or Sign in here ğŸ«‚</a>
        </p>
    </div>

</body>
</html>
