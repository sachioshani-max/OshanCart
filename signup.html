<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OshanCart | Alibaba Style Signup</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{display:flex;justify-content:center;align-items:flex-start;padding-top:30px;background:#0B1D3A;}
.container{width:90%;max-width:420px;background:#FF6EC7;border-radius:15px;padding:30px;text-align:center;color:white;box-shadow:0 15px 40px rgba(0,0,0,0.5);}
h2{margin-bottom:25px;font-weight:600;}
.btn-white{width:100%;padding:12px;margin-bottom:15px;border:none;border-radius:50px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:600;text-decoration:none;transition:.3s;background:white;color:#0B1D3A;font-size:15px;}
.btn-white img{width:22px;margin-right:15px;}
.btn-white i{font-size:20px;margin-right:15px;}
.divider{margin:20px 0;color:rgba(255,255,255,0.5);font-size:13px;display:flex;align-items:center;}
.divider::before,.divider::after{content:"";flex:1;height:1px;background:rgba(255,255,255,0.2);margin:0 15px;}
.form-step{display:none;}
.form-step.active{display:block;}
input[type=text],input[type=email],input[type=password],input[type=tel],input[type=file]{width:100%;padding:10px;margin:8px 0;border-radius:4px;border:none;}
button.next, button.back, button.submit{width:100%;padding:12px;margin-top:10px;border:none;border-radius:50px;background:#fff;color:#0B1D3A;font-weight:600;cursor:pointer;}
#progress-bar{display:flex;justify-content:space-between;margin-bottom:20px;}
.step{width:30px;height:30px;line-height:30px;border-radius:50%;background:#ddd;text-align:center;font-weight:bold;color:#333;}
.step.active{background:#fff;color:#FF6EC7;}
#gift-box{margin:15px 0;width:120px;height:120px;background:#fff url('https://via.placeholder.com/120') center/cover no-repeat;border-radius:15px;}
.avatar-preview{width:50px;height:50px;border-radius:50%;margin:10px auto;background:#fff;background-size:cover;background-position:center;}
</style>
</head>
<body>
<div class="container">

    <div id="progress-bar">
        <div class="step active">1</div>
        <div class="step">2</div>
        <div class="step">3</div>
        <div class="step">4</div>
        <div class="step">5</div>
    </div>

    <div id="gift-box"></div>
    <div id="avatar" class="avatar-preview"></div>

    <div class="form-step active" id="step1">
        <h2>Global Trading Made Simple</h2>
        <div class="btn-white" onclick="loginGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg">Continue with Google
        </div>
        <div class="btn-white" style="color:#0B1D3A;" onclick="loginFacebook()">
            <i class="fab fa-facebook"></i>Continue with Facebook
        </div>
        <div class="btn-white" onclick="nextStep(2)">
            <i class="fas fa-envelope"></i>Continue with Email
        </div>
    </div>

    <div class="form-step" id="step2">
        <h2>User Info</h2>
        <input type="text" id="fullName" placeholder="Full Name">
        <input type="email" id="email" placeholder="Email">
        <input type="tel" id="phone" placeholder="Phone Number (Optional)">
        <button class="next" onclick="nextStep(3)">Next</button>
        <button class="back" onclick="nextStep(1)">Back</button>
    </div>

    <div class="form-step" id="step3">
        <h2>Verify Phone</h2>
        <input type="tel" id="phoneOtpInput" placeholder="Enter phone number for OTP">
        <div id="recaptcha-container"></div>
        <button class="next" onclick="sendOTP()">Send OTP</button>
        <input type="text" id="otpCode" placeholder="Enter OTP" style="display:none;">
        <button class="next" id="verifyOtpBtn" style="display:none;" onclick="verifyOTP()">Verify OTP</button>
        <button class="back" onclick="nextStep(2)">Back</button>
    </div>

    <div class="form-step" id="step4">
        <h2>Set Password</h2>
        <input type="password" id="password" placeholder="Password">
        <input type="password" id="confirmPassword" placeholder="Confirm Password">
        <button class="next" onclick="nextStep(5)">Next</button>
        <button class="back" onclick="nextStep(3)">Back</button>
    </div>

    <div class="form-step" id="step5">
        <h2>Accept Terms</h2>
        <label><input type="checkbox" id="terms"> I accept terms & conditions</label>
        <button class="submit" onclick="submitSignup()">Submit</button>
        <button class="back" onclick="nextStep(4)">Back</button>
    </div>

    <div class="form-step active" style="margin-top:30px;">
        <h2>Admin Panel (Upload Gift Box)</h2>
        <input type="file" id="giftUpload" accept="image/*">
        <button class="next" onclick="uploadGiftImage()">Upload</button>
    </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, FacebookAuthProvider, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
    authDomain: "oshancart.firebaseapp.com",
    projectId: "oshancart",
    storageBucket: "oshancart.firebasestorage.app",
    messagingSenderId: "686982543488",
    appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentStep = 1;
function nextStep(step){
    document.querySelector(`#step${currentStep}`).classList.remove('active');
    document.querySelector(`#step${step}`).classList.add('active');
    document.querySelectorAll('.step')[currentStep-1]?.classList.remove('active');
    document.querySelectorAll('.step')[step-1]?.classList.add('active');
    currentStep = step;
}

window.loginGoogle = () => {
    const provider = new GoogleAuthProvider();
    signInWithPopup(auth, provider).then(res=>{
        const user = res.user;
        document.getElementById("fullName").value = user.displayName||'';
        document.getElementById("email").value = user.email||'';
        if(user.photoURL) document.getElementById("avatar").style.backgroundImage = `url(${user.photoURL})`;
        nextStep(4);
    }).catch(e=>alert(e.message));
}

window.loginFacebook = () => {
    const provider = new FacebookAuthProvider();
    signInWithPopup(auth, provider).then(res=>{
        const user = res.user;
        document.getElementById("fullName").value = user.displayName||'';
        document.getElementById("email").value = user.email||'';
        if(user.photoURL) document.getElementById("avatar").style.backgroundImage = `url(${user.photoURL})`;
        nextStep(4);
    }).catch(e=>alert(e.message));
}

let confirmationResult;
window.sendOTP = () => {
    const phone = document.getElementById("phoneOtpInput").value;
    if(!phone){ alert("Enter phone number"); return; }
    window.recaptchaVerifier = new RecaptchaVerifier('recaptcha-container', {}, auth);
    signInWithPhoneNumber(auth, phone, window.recaptchaVerifier).then(res=>{
        confirmationResult = res;
        alert("OTP sent!");
        document.getElementById("otpCode").style.display = "block";
        document.getElementById("verifyOtpBtn").style.display = "block";
    }).catch(e=>alert(e.message));
}
window.verifyOTP = () => {
    const code = document.getElementById("otpCode").value;
    if(!code){ alert("Enter OTP"); return; }
    confirmationResult.confirm(code).then(res=>{
        alert("Phone verified!");
        nextStep(4);
    }).catch(e=>alert(e.message));
}

async function submitSignup(){
    const name = document.getElementById("fullName").value;
    const email = document.getElementById("email").value;
    const phone = document.getElementById("phone").value;
    const password = document.getElementById("password").value;
    const confirm = document.getElementById("confirmPassword").value;
    const terms = document.getElementById("terms").checked;

    if(!name||!email||!password||!confirm){ alert("Fill all fields"); return; }
    if(password!==confirm){ alert("Passwords do not match"); return; }
    if(!terms){ alert("Accept terms first"); return; }

    try{
        const userRef = doc(db,"users",email);
        await setDoc(userRef,{name,email,phone,password,createdAt:new Date()});
        alert("Signup Successful! âœ…");
    } catch(e){ alert("Error saving user: "+e.message); }
}

window.uploadGiftImage = () => {
    const file = document.getElementById("giftUpload").files[0];
    if(!file){ alert("Select image first"); return; }
    const reader = new FileReader();
    reader.onload = e => { document.getElementById("gift-box").style.backgroundImage = `url('${e.target.result}')`; }
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
