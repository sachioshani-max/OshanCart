<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin | OshanCart Global</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --oshan-orange: #ff6600; --dark-bg: #0f172a; --card-bg: #1e293b; --danger: #ef4444; }
        body { font-family: 'Poppins', sans-serif; background: var(--dark-bg); color: #f1f5f9; margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding-bottom: 20px; border-bottom: 1px solid #334155; margin-bottom: 30px;
        }

        .admin-card {
            background: var(--card-bg); border-radius: 15px; padding: 20px; margin-bottom: 20px;
            display: grid; grid-template-columns: 1fr 2fr 1.2fr 0.3fr; gap: 20px;
            align-items: center; border: 1px solid #334155; transition: 0.3s;
        }
        .admin-card:hover { border-color: var(--oshan-orange); transform: translateY(-2px); }

        .prod-info h4 { margin: 0; color: var(--oshan-orange); font-size: 18px; }
        .prod-info p { margin: 5px 0; font-size: 12px; color: #94a3b8; }

        .cust-info { border-left: 1px solid #334155; padding-left: 20px; }
        .cust-info p { margin: 3px 0; font-size: 13px; color: #cbd5e1; }
        .cust-info i { color: #38bdf8; width: 20px; }

        .status-select {
            padding: 10px; border-radius: 8px; background: #0f172a; color: white; 
            border: 1px solid var(--oshan-orange); width: 100%; margin-bottom: 10px;
        }
        .update-btn {
            background: var(--oshan-orange); color: white; border: none; padding: 10px;
            border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s;
        }
        .delete-btn {
            background: none; color: var(--danger); border: none; cursor: pointer; 
            font-size: 18px; transition: 0.3s; opacity: 0.6;
        }
        .delete-btn:hover { opacity: 1; transform: scale(1.1); }

        .badge { padding: 4px 10px; border-radius: 5px; font-size: 10px; text-transform: uppercase; font-weight: bold; }
        .bg-pending { background: #7f1d1d; color: #fecaca; animation: blink 2s infinite; }
        .bg-shipped { background: #1e3a8a; color: #bfdbfe; }
        .bg-delivered { background: #064e3b; color: #a7f3d0; }

        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

        @media (max-width: 900px) {
            .admin-card { grid-template-columns: 1fr; }
            .cust-info { border-left: none; border-top: 1px solid #334155; padding-top: 15px; }
            .actions { text-align: center; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h2><i class="fas fa-user-shield"></i> OshanCart Admin</h2>
        <div id="stats" style="background: var(--oshan-orange); padding: 5px 15px; border-radius: 20px; font-size: 14px;">Orders: Loading...</div>
    </header>

    <div id="adminOrderList">
        <div style="text-align: center; padding: 50px;">
            <i class="fas fa-spinner fa-spin" style="font-size: 30px;"></i>
            <p>Fetching Orders...</p>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDy430AP0t92QND_VdaoCkK0J23y2c5rkE",
    authDomain: "oshancart.firebaseapp.com",
    projectId: "oshancart",
    storageBucket: "oshancart.appspot.com",
    messagingSenderId: "686982543488",
    appId: "1:686982543488:web:d74a83a3f53dbae3754e65"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// à¶¸à·™à¶­à¶±à·’à¶±à·Š à¶´à·ƒà·Šà·ƒà·š loadAdminOrders() à·€à¶œà·š functions à¶½à·’à¶ºà¶±à·Šà¶±...

    function loadAdminOrders() {
        db.collection("orders").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
            const list = document.getElementById('adminOrderList');
            document.getElementById('stats').innerText = `Total Orders: ${snapshot.size}`;
            list.innerHTML = "";
            
            if(snapshot.empty) {
                list.innerHTML = `<div style="text-align:center; padding:50px;"><h3>No Orders Yet! ðŸ“¦</h3></div>`;
                return;
            }

            snapshot.forEach((doc) => {
                const order = doc.data();
                const date = order.timestamp ? new Date(order.timestamp.toDate()).toLocaleString() : 'N/A';
                const statusStr = order.status || 'Pending';
                const statusLower = statusStr.toLowerCase();

                list.innerHTML += `
                    <div class="admin-card">
                        <div class="prod-info">
                            <span class="badge bg-${statusLower}">${statusStr}</span>
                            <h4>${order.productName || 'Unknown Product'}</h4>
                            <p>ID: #${doc.id.substring(0,8).toUpperCase()}</p>
                            <p><i class="far fa-clock"></i> ${date}</p>
                            <h3 style="color:white; margin:10px 0 0 0;">Rs. ${order.totalPrice || '0.00'}</h3>
                        </div>

                        <div class="cust-info">
                            <p><i class="fas fa-user"></i> ${order.customerName || 'N/A'}</p>
                            <p><i class="fas fa-phone"></i> ${order.customerPhone || 'N/A'}</p>
                            <p><i class="fas fa-map-marker-alt"></i> ${order.customerAddress || 'N/A'}</p>
                        </div>

                        <div class="actions">
                            <select id="select-${doc.id}" class="status-select">
                                <option value="Pending" ${statusStr === 'Pending' ? 'selected' : ''}>Pending</option>
                                <option value="Processing" ${statusStr === 'Processing' ? 'selected' : ''}>Processing</option>
                                <option value="Shipped" ${statusStr === 'Shipped' ? 'selected' : ''}>Shipped</option>
                                <option value="Delivered" ${statusStr === 'Delivered' ? 'selected' : ''}>Delivered</option>
                            </select>
                            <button class="update-btn" onclick="updateStatus('${doc.id}')">
                                <i class="fas fa-save"></i> Save Status
                            </button>
                        </div>

                        <div style="text-align: center;">
                            <button class="delete-btn" onclick="deleteOrder('${doc.id}')" title="Delete Order">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        });
    }

    function updateStatus(id) {
        const newStatus = document.getElementById(`select-${id}`).value;
        db.collection("orders").doc(id).update({
            status: newStatus
        }).then(() => {
            // Notification à¶‘à¶šà¶šà·Š à·€à¶œà·š à¶¯à·™à¶ºà¶šà·Š à¶¸à·™à¶­à¶±à¶§ à¶¯à·à¶±à·Šà¶± à¶´à·”à·…à·”à·€à¶±à·Š
        }).catch((error) => alert("Error: " + error.message));
    }

    function deleteOrder(id) {
        if(confirm("Are you sure you want to delete this order? This cannot be undone!")) {
            db.collection("orders").doc(id).delete();
        }
    }

    window.onload = loadAdminOrders;
</script>
</body>
</html>
